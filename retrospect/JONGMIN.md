# 남궁종민

## 환경변수를 .env에서 읽어오지 못하는 문제

express 서버를 연결할 때 .env 파일에서 환경변수를 읽어오지 못하는 문제. 처음엔 루트 디렉토리에 깔려 있다면 상속받아 당연히 사용이 가능하다고 생각함.
.env 파일을 읽어오기 위해서는 해당 파일이 존재하는 디렉토리의 package.json 안에 관련 npm이 깔려있어야 했음.
각 툴이나 라이브러리 사용에 있어서 for begginers 문서를 자세히 봐야겠다고 생각.

## JSON Web Token에 대한 전체적인 이해

로그인 방식에서 JWT를 왜 쓰는지에 대한 근본적인 의문이 있었음

- 로그인 방식 cookie / session / JWT / + Oauth2.0을 사용해 로그인 정보를 서버가 직접 관리하지 않는 방식

1. session: 서버에 부담이 크게 감, session store에 사용자가 로그인을 할 때마다 session id를 담은 객체가 생성이되고, 서비스 규모가 클 경우 사용자 정보를 담는 데이터만으로도 큰 부담이됨. 매 요청마다 서버가 DB에 접근해야하며 이 자체가 서버에 큰 페이로드를 요구함.

2. cookie: 서버에 부담이 세션에 비해 덜하지만 클라이언트 측에서 위변조가 가능하다는 치명적인 단점 존재.
   -> 그래서 JWT(JSON Web Token)이 등장함 (jwt를 보낼 때 httpOnly 속성을 true 해줌으로써 위변조 차단 가능)

### JWT

- 토큰을 가진 사용자만이 권한 증명을 할 수 있음.
- 서버의 부담을 크게 덜어줌: 사용자 정보를 세션처럼 서버에서 저장을 할 필요가 없음(서버에서는 암호화된 토큰을 생성을 해서 클라이언트에 전달만 하면됨)
- 암호화 된 토큰을 사용해 통신을 확립하기 때문에 안전한 통신 가능
- 토큰 발행 전용 서버를 개설해 메인 서비스를 제공하는 서버와 별개로 서버를 운영할 수 있음: 서버의 부담 완화 가능
- 토큰에 로그인을 하고 이후에 어떤 권한을 담을지(매니저 권한, 어드민개정을 줄지), 특정한 사용자 별로 특정 권한을 심어서 개인 토큰을 발행할 수 있음.

  #### Access Token: 유효기간이 매우 짧아 보안적인 이득이 있음. 길어야 30분

  #### Refresh Token: Access Token은 보안적 측면에서 유리하지만 유효기간이 짧아 사용자가 로그인을 자주 해주어야 한다는 단점이 존재. Refresh Token을 통해 Access Token을 갱신 해줌으로써 Access Token의 단점을 극복. 두개를 같이 쓸 때 JWT를 사용하는 의의가 완성됨.

### 구조

{Header}.{Payload}.{Signature}로 구성됨.
Header: 토큰 타입 지정 / 알고리즘 명시
Payload: 토큰에 권한을 부여, 사용자 정보를 선택해 담을 수 있음

### JWT 인증 절차

![](images/2022-12-15-01-44-31.png)

1. 사용자 로그인 요청(로그인 요청을 할 때, 사용자는 body에 사용자 정보를 담아서 요청)
2. 사용자기 요청한 정보를 담아서 암호화된 토큰 생성(AccessToken + RefreshToken)
3. 서버로부터 응답받은 클라이언트가 (cookie, state)등에 저장(사용자가 선택)
4. 이 후 모든 요청에 토큰을 태워 요청함: 토큰에 대한 정보가 Header에 담김.
5. 사용자는 토큰을 가지고 유저 식별

## 구현한 서버에서 클라이언트에 jwt반환을 확인하기 위한 테스트에서 웹서버가 정적 리소스를 반환하지 못하는 문제

웹서버는 클라이언트가 요청한 데이터요청에 대한 응답뿐만 아니라 추가적인 기능들이 있음.
정적 리소스 반환(HTML, CSS) / 프록시(Proxy Server) / 트래픽 분산(로드 밸런서)
TODO: 서버와 클라이언트의 Restfu API를 통한 데이터 교류 / 정적 파일 최초 로드 공부
